name: MacOS Monterey Swift Release CI

on:
  push:
    branches: [development, main]
  pull_request:
    branches: [development, main]

jobs:

  exec-mac-ci-release:
    runs-on: self-hosted 

    steps:
      - name: Remove everything
        run: rm -rf *

      - name: Checkout repo
        uses: actions/checkout@v2
      
      #- name: Reconfigure Private Repo URLs
      #  run: sed -i 's/git@github.com:/https:\/\/${{ secrets.ACCESS_TOKEN }}@github.com\//g' Package.swift

      - name: Release build
        run: swift build -c release

      - name: Release Test
        run: swift test -c release -Xswiftc -DRELEASE_BUILD
